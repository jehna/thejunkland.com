<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><style>body>*,header span,img{margin:0 auto}@font-face{font-family:Oswald;font-style:normal;font-weight:400;src:local("Oswald Regular"),local("Oswald-Regular"),url(/oswald.woff) format("woff")}h1,h2,h3,h4,h5,h6,header{font-family:Oswald,sans-serif;padding-top:38px;color:#3b447c;line-height:1.2em;text-align:center}img{max-width:100%;height:auto;display:block}h1{opacity:.8;font-size:1.6em}body,html{margin:0;padding:0}body{font:19px Georgia,serif;color:#333;-webkit-font-smoothing:antialiased}p,section nav{line-height:1.4em}body>*{max-width:740px;box-sizing:border-box;padding-left:19px;padding-right:19px}p{padding-top:1em;margin-top:0;margin-bottom:0}article p:first-child{font-size:1.4em;line-height:1.4em;padding-bottom:.2em}header{background:#6672B7;color:#FFF;padding:1.6em .4em;font-size:2.4em;line-height:1.2em;text-align:center;max-width:100%;font-weight:400}header span{max-width:640px;display:block;text-shadow:0 3px 0 rgba(0,0,0,.2)}header small{display:block;font-size:.43em;font-family:Georgia,serif;text-shadow:0 2px 0 rgba(0,0,0,.2)}header img{border-radius:50%;vertical-align:middle;width:40px;height:40px}code,pre{overflow-x:auto;max-width:100%}a{color:#6672B7}a:visited{color:tint(#6672B7,20%)}section nav{font-size:1.4em}</style><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="shortcut icon" href="/favicon.ico"><title>In-browser notepad</title><meta name="description" content="Sometimes you need a quick, auto-saving, offline notepad. This blog post describes the author's journey of creating the best broser-based notepad — Notepadlet."><link rel="manifest" href="/manifest.webmanifest"></head><body><header><span>In-browser notepad</span> <small>A blog post by Jesse Luoto</small></header><main><article><p>The in-browser Notepad script is a handy tool to have a quick place to paste things from web. But how can we improve it further?</p><p>This blog post is about my journey on improving the <a href="http://lifehacker.com/5980134/turn-any-browser-window-into-a-quick-edit-notepad">Notepad life hack</a> bookmarklet.</p><h1 id="the-original-script">The original script</h1><p>I can&#39;t fully remember where I first stumbled upon the idea, but it&#39;s covered in many publications around the Internet. The basic idea is simple - just copy-paste a special URL to your address bar and ta-da! You have a notepad.</p><p>The full, original script is here:</p><pre><code class="lang-nohighlight">data:text/html, &lt;html contenteditable&gt;
</code></pre><p>Pasting that to your browser creates an empty web page with a <code>data:</code> URL that has the HTML5 <code>contenteditable</code> attribute specified.</p><p>This allows the user to edit the content of the page, which is indicated by the blinking cursor. You can start typing right away:</p><p><img alt="Empty notepad" src="/images/hello-world-notepad.png" width="396" height="73"></p><h1 id="bringing-some-styles-to-equation">Bringing some styles to equation</h1><p>After some time of using the script, I thought I&#39;m not so happy using a tool that uses <em>Times New Roman</em> as the font.</p><p>Including a big system like Bootstrap in a bookmarklet would&#39;ve sure been an overkill. I&#39;d never use most of the CSS anyway. So initially I chose the lightweight <a href="http://yegor256.github.io/tacit/">Tacit CSS framework</a> to be included in the bookmarklet.</p><p>Since it was just a tool for myself, I added a simple <code>&lt;link&gt;</code> tag to the head of the document and voilà: An instant better-looking Notepad for me!</p><pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">contenteditable</span>=<span class="hljs-string">""</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://yegor256.github.io/tacit/tacit.min.css"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre><h2 id="how-about-line-breaks-">How about line breaks?</h2><p>Since there was a bunch of code now, including line breaks, I figured it would be more intuitive to use a <em>base64 encoded</em> data URL.</p><p>After making the edits in the Chrome&#39;s developer tools, I used this quick script to convert the whole website to base64 data URL:</p><pre><code class="lang-javascript"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'data:text/html;base64,'</span> + btoa(<span class="hljs-built_in">document</span>.documentElement.outerHTML));
</code></pre><p>This takes the content of the whole website, encodes it as a base64 string and prints it in the base64 URL template.</p><h1 id="going-offline">Going offline</h1><p>Even though I live with a decent fibre connection, I often find myself hacking things in the most obscure places with a poor Internet connection.</p><p>One example of these is the train I commonly use; while it has a shared 4G wifi hotspot, there are unavoidable blind spots on the way that just block the whole Internet for a minute or two.</p><p>Commonly I noticed the connection losses when I opened the notepad and witnessed the absence of styles. I was back again with the Times New Roman.</p><p>So time for another update of the notepad script: Inlining the styles so I could work fully offline whenever I wanted to.</p><h1 id="saving-the-data">Saving the data</h1><p>Like all the good projects, also this one was directed purely on the amount of swearing occurred by the missing features.</p><p>One of the biggest issues of the design was, that there was no way to actually save the data. If the browser crashed, the computer restarted, or I just ran out of battery, it always meant my Notepad woke up with a blank page.</p><p>So hey, I&#39;ll just save the whole page to the <code>localStorage</code> and I&#39;ll be safe whatever happens. Right?</p><h2 id="browsers-don-t-really-work-that-way">Browsers don&#39;t really work that way</h2><p>Error after another error. The hard way I figured that browsers are build so they use the URL of the page as an unique identifier for the data.</p><p>For a data URL, though, all the features using the URL as unique identifier were a big no-no. Using cookies, localStorage or even the fresh <a href="https://developer.mozilla.org/en-US/docs/Web/API/LocalFileSystem">File System API</a> all just kicked the bucket.</p><p>Fortunately offering a decent bounty for a <a href="http://stackoverflow.com/a/37541068/2697279">StackOverflow question</a> found a perfect solution for the problem:</p><blockquote><p>Just use the URL itself to store the data!</p></blockquote><p>In its all simplicity - I change the URL every time I want to save the document. The browser&#39;s history detects and saves the fresh URL, and even if the browser crashes, I can just <code>cmd + shift + t</code> to have all the saved data restored.</p><p>To implement this, I just added a simple event listener to save the page each time I left the tab:</p><pre><code class="lang-javascript"><span class="hljs-built_in">document</span>.documentElement.addEventListener(<span class="hljs-string">'blur'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{
   <span class="hljs-built_in">window</span>.location = <span class="hljs-string">'data:text/html;base64,'</span> + btoa(<span class="hljs-built_in">document</span>.documentElement.outerHTML);
});
</code></pre><h2 id="what-about-the-title-">What about the title?</h2><p>Now that the page got saved in the browser&#39;s history, I needed an intuitive way to search for the past documents. And this view wasn&#39;t actually helping:</p><p><picture><source srcset="/images/history-tab-x2.png" media="(-webkit-min-device-pixel-ratio: 2) and (min-width: 702px)"><img alt="So many similar histories" src="/images/history-tab.png" width="702" height="125"></picture></p><p>To make history searching more convenient, I figured adding a proper <code>&lt;title&gt;</code> tag to the page would help. But how to customize the title for each different notepad?</p><pre><code class="lang-javascript"><span class="hljs-built_in">document</span>.body.addEventListener(<span class="hljs-string">'blur'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{
   <span class="hljs-keyword">var</span> h1 = <span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">'h1'</span>);
   h1.length &amp;&amp; (<span class="hljs-built_in">document</span>.title = <span class="hljs-string">"Notepadlet - "</span> + h1[<span class="hljs-number">0</span>].innerText);
   <span class="hljs-built_in">window</span>.location = <span class="hljs-string">'data:text/html;base64,'</span> + btoa(<span class="hljs-built_in">document</span>.documentElement.outerHTML);
});
</code></pre><p>You guessed it: Just adding a simple <code>&lt;h1&gt;</code> tag that matches the title worked like a charm. Now the browser history made a lot more sense - and the project finally had a name!</p><p><picture><source srcset="/images/history-with-names-x2.png" media="(-webkit-min-device-pixel-ratio: 2) and (min-width: 702px)"><img alt="Now they have names!" src="/images/history-with-names.png" width="702" height="125"></picture></p><h1 id="a-fresh-ui">A fresh UI</h1><p>Since the <code>&lt;h1&gt;</code> tag made the layout look rather ugly, it was time to give the project the layout it really deserved.</p><p>Being a coder, rather than a designer, I figured I&#39;d be better off using some ready components with my design. That led me to use the awesome <a href="http://lea.verou.me/css3patterns/">CSS3 patterns by Lea Verou</a>. And the result turned out prettier than I had hoped:</p><p><picture><source srcset="/images/notepadlet-with-css-x2.png" media="(-webkit-min-device-pixel-ratio: 2) and (min-width: 702px)"><img alt="Now they have names!" src="/images/notepadlet-with-css.png" width="702" height="125"></picture></p><p>I also added styles for mobile devices, so with Chrome&#39;s instant history sync, I always have my <em>Notepadlets</em> available when I change between devices.</p><h1 id="but-wait-there-s-more">But wait, there&#39;s more</h1><p>As with many free-time projects, I found myself coding like a madman at 2AM, figuring out the next awesome feature I could add to the project.</p><p>This time it was the image upload.</p><p>Having a history with the <a href="https://developer.mozilla.org/en-US/docs/Web/Events/drop">JavaScript drag &amp; drop API</a>, I just absolutely wanted to solve the single most painful aspect of <em>wysiwyg editors</em>: The image upload.</p><p>And here&#39;s the result: You can just drag &amp; drop an image to the page and the Notepadlet automatically reads it, converts it to base64-encoded image and inserts it to the page. Simply awesome.</p><p><img src="/images/drag-and-drop.png" alt="Now they have names!"></p><h1 id="takeaway">Takeaway</h1><p>Best of all, I open-sourced the code, so you can have <a href="http://jehna.github.io/notepadlet">your own copy of Notepadlet</a> installed in seconds.</p><p>The whole project is open-sourced and you can have a look at it at the <a href="https://github.com/jehna/notepadlet">Notepadlet&#39;s Github repository</a>.</p><p>If you have any improvements or suggestions, I&#39;m always very happy to hear them.</p><p>As a takeaway I&#39;d like to end with these words:</p><blockquote><p>Just keep hacking. Even your most insignificant project can some day extend to unimaginable proportions.</p></blockquote><p><a href="https://twitter.com/intent/tweet?text=%22In-browser%20notepad%22%20by%20@luotojesse%20https://thejunkland.com/blog/improving-on-the-in-browser-notepad-script.html" class="twittershare" target="_blank">Tweet</a></p><form action="https://script.google.com/macros/s/AKfycbxRbnrX_4N2LPp7P2DIYuVA9BqnZeJPKHZaNedhjakItb9Rxm83/exec" method="POST"><h3>Be the first to know from new&nbsp;blog&nbsp;posts</h3><p>Subscrbe to the mailing list to get priority access to new blog posts!</p><div><input type="email" name="email" placeholder="Your email address"></div><button type="submit">Subscribe!</button></form></article></main><footer><p>This site was made with &#9825; by Jesse Luoto.</p><p>Header font is <a href="https://www.google.com/fonts/specimen/Oswald">Oswald Regular</a> from Google Fonts</p><nav><a href="/index.html">Blog</a> <a href="/about.html">About</a></nav></footer><script src="/scripts.9b58f1c3.js" async></script></body></html>