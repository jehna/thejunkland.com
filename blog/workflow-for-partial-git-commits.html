<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><style>body>*,header span,img{margin:0 auto}@font-face{font-family:Oswald;font-style:normal;font-weight:400;src:local("Oswald Regular"),local("Oswald-Regular"),url(/oswald.woff) format("woff")}h1,h2,h3,h4,h5,h6,header{font-family:Oswald,sans-serif;padding-top:38px;color:#0d1113;line-height:1.2em;text-align:center}img{max-width:100%;height:auto;display:block}h1{opacity:.8;font-size:1.6em}body,html{margin:0;padding:0}body{font:19px Georgia,serif;color:#333;-webkit-font-smoothing:antialiased}p,section nav{line-height:1.4em}body>*{max-width:740px;box-sizing:border-box;padding-left:19px;padding-right:19px}p{padding-top:1em;margin-top:0;margin-bottom:0}article p:first-child{font-size:1.4em;line-height:1.4em;padding-bottom:.2em}header{background:#7b8ad6;color:#FFF;padding:1.6em .4em;font-size:2.4em;line-height:1.2em;text-align:center;max-width:100%;font-weight:400}header span{max-width:640px;display:block;text-shadow:0 3px 0 rgba(0,0,0,.2)}header small{display:block;font-size:.5em;font-family:Georgia,serif;opacity:.8}header img{border-radius:50%;vertical-align:middle;width:40px;height:40px}code,pre{overflow-x:auto;max-width:100%}a{color:#7b8ad6}a:visited{color:#95a1de}section nav{font-size:1.4em}</style><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="shortcut icon" href="/favicon.ico"><title>Workflow for partial Git commits</title></head><body><header><span>Workflow for partial Git commits</span> <small>A blog post by Jesse Luoto</small></header><article><p>Here&#39;s the scenario: You&#39;ve coded for a whole day and not done a single <code>git commit</code> yet. How do you avoid 500+ line commits and break up your work to logical commits?</p><h1 id="copy-your-workflow-from-xcode">Copy your workflow from XCode</h1><p>If you&#39;ve ever done a commit with XCode, you know that one thing the Apple&#39;s developers got right: The Version Editor.</p><picture><source srcset="/images/xcode-version-editor-x2.png" media="(-webkit-min-device-pixel-ratio: 2) and (min-width: 702px)"><img alt="Xcode version editor" src="/images/xcode-version-editor.png"></picture><p>Version Editor lets you go through your changes you&#39;ve done after your latest commit. Before you write your commit message, you can briefly go through every file and <em>choose</em> whether to include that specific change or not.</p><h1 id="how-to-apply-apple-s-workflow-to-command-line-">How to apply Apple&#39;s workflow to command line?</h1><p>Your regular &quot;time to do a commit&quot; workflow probably looks something like this:</p><pre><code class="lang-bash"><span class="code-line">git add .</span>
<span class="code-line">git commit</span>
</code></pre><p>The bad news is, that you automatically commit everything that you&#39;ve touched since the last commit. So how could we change this workflow to have the same effect as with the XCode&#39;s version editor?</p><h2 id="introducing-stash-diff">Introducing stash diff</h2><p>The good news is, that you can do a trick with the <code>git stash</code> that pretty much mimics the workflow from XCode. This trick being, that you can do a <code>git diff</code> also to the most recent <code>stash</code>:</p><pre><code class="lang-bash"><span class="code-line">git diff stash</span>
</code></pre><p>Which shows the diff to the current stash. We can take it a step further and launch the interactive <code>difftool</code> (I&#39;m using OpenDiff) to go through the diffs, adding the changes back to stage one by one.</p><h1 id="taking-it-all-together">Taking it all together</h1><p>So let&#39;s go through the whole workflow one by one.</p><h2 id="1-add-everything-to-git">1. Add everything to git</h2><p>You should start up with your regular flow to make sure all changes are added to your git.</p><pre><code class="lang-bash"><span class="code-line">git add -A</span>
</code></pre><p>The <code>-A</code> flag adds every file to be committed, regardless of which directory you&#39;re currently in.</p><h2 id="2-push-the-changes-to-stash">2. Push the changes to stash</h2><pre><code class="lang-bash"><span class="code-line">git stash</span>
</code></pre><p>It doesn&#39;t matter if you already have something in your stash, since this command always adds a new stash to the stack.</p><h2 id="3-pick-which-changes-to-commit">3. Pick which changes to commit</h2><p>The following command opens up your difftool, which lets you pick the changes you&#39;ve made one by one back to stage:</p><pre><code class="lang-bash"><span class="code-line">git difftool -y stash</span>
</code></pre><p>Note that you actually have to select all the changes you want to commit <em>back</em> to your stage. If you&#39;re using OpenDiff, it means the arrow should point left to add that change to your commit.</p><picture><source srcset="/images/opendiff-x2.png" media="(-webkit-min-device-pixel-ratio: 2) and (min-width: 702px)"><img alt="OpenDiff arrow should point left to include it in the commit" src="/images/opendiff.png" width="645"></picture><p>When you&#39;re done with the file, hit <code>cmd</code> + <code>Q</code> to exit OpenDiff. When the program prompts you whether to save the file, make sure to overwrite the current file.</p><p><img alt="Say yes to OpenDiff" src="/images/opendiff-confirm.png" width="451"></p><h2 id="4-perform-the-commit">4. Perform the commit</h2><p>Up next is your common routine: committing.</p><pre><code class="lang-bash"><span class="code-line">git commit -a</span>
</code></pre><p>This creates a commit from the changes you just selected from the diff.</p><h2 id="5-pull-back-rest-of-the-changes">5. Pull back rest of the changes</h2><p>Now we should head back to where we started. We can do this by popping the most recently pushed stash:</p><pre><code class="lang-bash"><span class="code-line">git stash pop</span>
</code></pre><p>Note that the stash we pop <strong>does include the changes we already committed</strong>, but git just knows that it should discard them, since they&#39;re already present in the current branch.</p><h1 id="wrapping-it-up">Wrapping it up</h1><p>So here&#39;s the full workflow, ready for you to copy-paste:</p><pre><code class="lang-bash"><span class="code-line">git add -A</span>
<span class="code-line">git stash</span>
<span class="code-line">git difftool -y stash</span>
<span class="code-line">git commit -a</span>
<span class="code-line">git stash pop</span>
</code></pre><h1 id="bonus-alias">Bonus: Alias</h1><p>As we all like our thing simple, here&#39;s a quick alias that will make your life easier.</p><pre><code class="lang-bash"><span class="code-line">git config --global alias.pc '!git add -A; git stash; git difftool -y stash; git commit -a; git stash pop;'</span>
</code></pre><p>Running this command will create a global alias of <code>git pc</code> that does the whole workflow for you (pc as &quot;Partial Commit&quot;).</p><p>Enjoy!</p><p><a href="https://twitter.com/intent/tweet?text=%22Workflow%20for%20partial%20Git%20commits%22%20by%20@luotojesse%20https://thejunkland.com/blog/workflow-for-partial-git-commits.html" class="twittershare" target="_blank">Tweet</a></p></article><footer><p>This site was made with &#9825; by Jesse Luoto.</p><p>Header font is <a href="https://www.google.com/fonts/specimen/Oswald">Oswald Regular</a> from Google Fonts</p><nav><a href="/index.html">Blog</a> <a href="/about.html">About</a></nav></footer><script src="https://cdn.jsdelivr.net/ga-lite/latest/ga-lite.min.js" async></script><script src="/scripts.92d7e677.js" async></script></body></html>