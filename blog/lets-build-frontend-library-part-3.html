<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><style>body>*,header span,img{margin:0 auto}@font-face{font-family:Oswald;font-style:normal;font-weight:400;src:local("Oswald Regular"),local("Oswald-Regular"),url(/oswald.woff) format("woff")}h1,h2,h3,h4,h5,h6,header{font-family:Oswald,sans-serif;padding-top:38px;color:#3b447c;line-height:1.2em;text-align:center}img{max-width:100%;height:auto;display:block}h1{opacity:.8;font-size:1.6em}body,html{margin:0;padding:0}body{font:19px Georgia,serif;color:#333;-webkit-font-smoothing:antialiased}body>*{max-width:740px;box-sizing:border-box;padding-left:19px;padding-right:19px}p{line-height:1.4em;padding-top:1em;margin-top:0;margin-bottom:0}article p:first-child{font-size:1.4em;line-height:1.4em;padding-bottom:.2em}header{background:#6672B7;color:#FFF;padding:1.6em .4em;font-size:2.4em;line-height:1.2em;text-align:center;max-width:100%;font-weight:400}header span{max-width:640px;display:block;text-shadow:0 3px 0 rgba(0,0,0,.2)}header small{display:block;font-size:.43em;font-family:Georgia,serif;text-shadow:0 2px 0 rgba(0,0,0,.2)}header img{border-radius:50%;vertical-align:middle;width:40px;height:40px}code,pre{overflow-x:auto;max-width:100%}a{color:#6672B7}a:visited{color:tint(#6672B7,20%)}section nav{font-size:1.4em;line-height:1.4em}</style><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="shortcut icon" href="/favicon.ico"><title>Let's build a frontend library — Part 3: Implementation</title><link rel="manifest" href="/manifest.webmanifest"></head><body class="draft"><header><span>Let's build a frontend library — Part 3: Implementation</span> <small>A blog post by Jesse Luoto</small></header><main><article><h2 id="minimal-changes-from-the-library">Minimal changes from the library</h2><p>Let&#39;s say we would implement a library that only creates DOM nodes declaratively. How would it look like? The most naive way would require that we know where we&#39;d mount and what to mount. Something like:</p><pre><code class="lang-typescript"><span class="hljs-keyword">type</span> Component = <span class="hljs-function">(<span class="hljs-params">props: <span class="hljs-built_in">any</span>, parent: Node</span>) =&gt;</span> <span class="hljs-built_in">void</span>;
</code></pre><p>This way we could do a simple <code>div</code> component something like so:</p><pre><code class="lang-typescript"><span class="hljs-keyword">const</span> div: Component = <span class="hljs-function">(<span class="hljs-params">props, parent</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> el = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&quot;div&quot;</span>); <span class="hljs-comment">// Create element</span>
  <span class="hljs-built_in">Object</span>.entries(props).forEach(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> ((el <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>)[key] = value)); <span class="hljs-comment">// Set props</span>
  parent.appendChild(el); <span class="hljs-comment">// Mount element</span>
};
</code></pre><p>This way we could mount a simple <code>&lt;div&gt;</code> element with the following code:</p><pre><code class="lang-typescript">div({ innerText: <span class="hljs-string">&quot;Hello world&quot;</span> }, <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;app&quot;</span>)!);
</code></pre><p>Pretty good for a naive approach! But we&#39;ll need a declarative way of creating nested components, so let&#39;s add a special <code>children</code> prop and revisit the component type:</p><pre><code class="lang-typescript"><span class="hljs-keyword">type</span> Component = <span class="hljs-function">(<span class="hljs-params">props: <span class="hljs-built_in">any</span></span>) =&gt;</span> MountFn;
<span class="hljs-keyword">type</span> MountFn = <span class="hljs-function">(<span class="hljs-params">parent: Node</span>) =&gt;</span> <span class="hljs-built_in">void</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> div: Component = <span class="hljs-function">(<span class="hljs-params">{ children = [], ...props }</span>) =&gt;</span> (parent) =&gt; {
  <span class="hljs-keyword">const</span> el = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&quot;div&quot;</span>); <span class="hljs-comment">// Create element</span>
  <span class="hljs-built_in">Object</span>.entries(props).forEach(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> ((el <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>)[key] = value)); <span class="hljs-comment">// Set props</span>
  children.map(<span class="hljs-function">(<span class="hljs-params">child: MountFn</span>) =&gt;</span> child(el)); <span class="hljs-comment">// Mount children</span>
  parent.appendChild(el); <span class="hljs-comment">// Mount element</span>
};
</code></pre><p>After this our declarative app looks like this:</p><pre><code class="lang-typescript"><span class="hljs-keyword">const</span> mount = div({
  children: [
    div({ innerText: <span class="hljs-string">&quot;First line&quot;</span> }),
    div({ innerText: <span class="hljs-string">&quot;Second line&quot;</span> }),
  ],
});
mount(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;app&quot;</span>)!);
</code></pre><p>You can check out <a href="https://codesandbox.io/s/bold-river-jmytb?file=/src/index.ts">an example project</a> to test out this approach. Note that the example project only implements a few HTML tags and does not take state changes into account. We&#39;ll come back to state later, but the mount function serves as a good starting point for implementing minimal changes when state changes are detected.</p><p><a href="https://twitter.com/intent/tweet?text=%22Let%27s%20build%20a%20frontend%20library%20%u2014%20Part%203%3A%20Implementation%22%20by%20@luotojesse%20https://thejunkland.com/blog/lets-build-frontend-library-part-3.html" class="twittershare" target="_blank" rel="noopener">Tweet</a></p><form action="https://script.google.com/macros/s/AKfycbxRbnrX_4N2LPp7P2DIYuVA9BqnZeJPKHZaNedhjakItb9Rxm83/exec" method="POST"><h3>Be the first to know from new&nbsp;blog&nbsp;posts</h3><p>Subscribe to the mailing list to get priority access to new blog posts!</p><div><input type="email" name="email" placeholder="Your email address" aria-label="Your email address"></div><button type="submit">Subscribe!</button></form></article></main><footer><p>This site was made with &#9825; by Jesse Luoto.</p><p>Header font is <a href="https://www.google.com/fonts/specimen/Oswald">Oswald Regular</a> from Google Fonts</p><nav><a href="/index.html">Blog</a> <a href="/about.html">About</a></nav></footer><script src="/scripts.bd620f8c.js" async></script></body></html>